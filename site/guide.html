---
layout: default
title: The Wedding of John and Jamie
---

<script src='assets/javascripts/underscore-min.js'></script>

<script src='https://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.css' rel='stylesheet' />
<link href='assets/css/map.css' rel='stylesheet' />

<div id='pane'><div id='map'></div></div>

<article>
  <section id='cover' class='cover active' onclick='setActive(0, true)'>
    <h1>Our guide to New York</h1>
    <p>Here are a few of the places we like.</p>
  </section>
  <section id='char' onclick='setActive(1, true)'>
    <h2>Char No. 4</h2>
    <p>Lots of great whiskey.</p>
  </section>
  <section id='chuko' onclick='setActive(2, true)'>
    <h2>Chuko</h2>
    <p>This is a ramen restaurant near our house.</p>
  </section>
  <section id='shack' onclick='setActive(3, true)'>
    <h2>Shake Shack</h2>
    <p>Get the double stack!</p>
  </section>
  <section id='prospect' onclick='setActive(4, true)'>
    <h2>Prospect Park</h2>
    <p>Enjoy a nice stroll around the park.</p>
  </section>
  <section id='amsterdam' onclick='setActive(5, true)'>
    <h2>Amsterdam 106</h2>
    <p>We had our first date here.</p>
  </section>
</article>

<script>
var geojson = [
  { "geometry": { "type": "Point", "coordinates": [-73.9637, 40.6937] },
    "properties": { "id": "cover", "zoom": 13 } },
  { "geometry": { "type": "Point", "coordinates": [-73.9915, 40.6848] },
    "properties": { "id": "char" } },
  { "geometry": { "type": "Point", "coordinates": [-73.9680, 40.6802] },
    "properties": { "id": "chuko" } },
  { "geometry": { "type": "Point", "coordinates": [-73.9889, 40.6917] },
    "properties": { "id": "shack" } },
  { "geometry": { "type": "Point", "coordinates": [-73.9704, 40.6653] },
    "properties": { "id": "prospect" } },
  { "geometry": { "type": "Point", "coordinates": [-73.9656, 40.8004] },
    "properties": { "id": "amsterdam" } }
];
var tiles = mapbox.layer().tilejson({
  tiles: [ "https://a.tiles.mapbox.com/v3/examples.map-liczq28b/{z}/{x}/{y}.png" ]
});

// Use https for markers
mapbox.markers.marker_baseurl = 'https://a.tiles.mapbox.com/v3/marker/';

var spots = mapbox.markers.layer()
  // Load up markers from geojson data.
  .features(geojson)
  // Define a new factory function. Takes geojson input and returns a
  // DOM element that represents the point.


// Creates the map with tile and marker layers and
// no input handlers (mouse drag, scrollwheel, etc).
var map = mapbox.map('map', [tiles, spots], null, []);

// Array of story section elements.
var sections = document.getElementsByTagName('section');

// Array of marker elements with order matching section elements.
var markers = _(sections).map(function(section) {
  return _(spots.markers()).find(function(m) {
    return m.data.properties.id === section.id;
  });
});

// Helper to set the active section.
var setActive = function(index, ease) {
  // Set active class on sections, markers.
  _(sections).each(function(s) { s.className = s.className.replace(' active', '') });
  _(markers).each(function(m) { m.element.className = m.element.className.replace(' active', '') });
  sections[index].className += ' active';
  markers[index].element.className += ' active';

  // Set a body class for the active section.
  document.body.className = 'section-' + index;

  // Ease map to active marker.
  if (!ease) {
    map.centerzoom(markers[index].location, markers[index].data.properties.zoom||14);
  } else {
    map.ease.location(markers[index].location).zoom(markers[index].data.properties.zoom||14).optimal(0.5, 1.00);
  }

  return true;
};

// Bind to scroll events to find the active section.
// window.onscroll = _(function() {
//   // IE 8
//   if (window.pageYOffset === undefined) {
//     var y = document.documentElement.scrollTop;
//     var h = document.documentElement.clientHeight;
//   } else {
//     var y = window.pageYOffset;
//     var h = window.innerHeight;
//   }
//
//   // If scrolled to the very top of the page set the first section active.
//   if (y === 0) return setActive(0, true);
//
//   // Otherwise, conditionally determine the extent to which page must be
//   // scrolled for each section. The first section that matches the current
//   // scroll position wins and exits the loop early.
//   var memo = 0;
//   var buffer = (h * 0.3333);
//   var active = _(sections).any(function(el, index) {
//     memo += el.offsetHeight;
//     return y < (memo-buffer) ? setActive(index, true) : false;
//   });
//
//   // If no section was set active the user has scrolled past the last section.
//   // Set the last section active.
//   if (!active) setActive(sections.length - 1, true);
// }).debounce(10);

// Set map to first section.
setActive(0, false);
</script>
